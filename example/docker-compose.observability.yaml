services:
  # Grafana stack is used for CPMS observability purposes.
  # For capturing metrics, you can configure the exporters via environment variables
  # to either Prometheus or OTel Collector (default).
  # Prometheus needs to be configured so it can scrape your application instance(s).
  # To simplify testing and development, we will use the Otel collector as the default.
  # Your CPMS backend will push the metrics in OTLP format to the Otel collector.
  # The collector comes as a part of the LGTM stack.
  grafana-lgtm-stack:
    image: grafana/otel-lgtm:latest
    container_name: lgtm-stack
    hostname: lgtm-stack
    #environment:
    #  - GF_SECURITY_ADMIN_USER="admin"
    #  - GF_SECURITY_ADMIN_PASSWORD="admin"
    volumes:
      - prometheus:/prometheus
      - loki:/data/loki
      - grafana:/var/lib/grafana
      - ./grafana-provision/grafana:/etc/grafana/provisioning
    networks:
      - sim
    ports:
      - "3000:3000" # Grafana
      - "4317:4317" # OTLP gRPC receiver
      - "9097:9097" # Pyroscope (profiling)
      - "9090:9090" # Prometheus

networks:
  sim:
    driver: bridge

volumes:
  prometheus:
  loki:
  grafana: